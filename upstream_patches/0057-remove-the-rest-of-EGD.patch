From e9ce56830782cb774ab97ce5781f7fabef6458e8 Mon Sep 17 00:00:00 2001
From: "Aaron Sethman (androsyn)" <androsyn@ratbox.org>
Date: Tue, 13 Oct 2015 14:48:47 +0000
Subject: [PATCH 57/89] remove the rest of EGD

git-svn-id: http://svn.ratbox.org/svnroot/ircd-ratbox/branches/RATBOX_3_0@28755 b93f080a-4cfa-0310-a19a-80a68f531ef9
---
 include/s_conf.h | 3 ---
 src/ircd.c       | 7 +------
 src/newconf.c    | 2 --
 src/s_conf.c     | 2 --
 src/sslproc.c    | 5 +----
 5 files changed, 2 insertions(+), 17 deletions(-)

diff --git a/include/s_conf.h b/include/s_conf.h
index 124dde9..c6e36ff 100644
--- a/include/s_conf.h
+++ b/include/s_conf.h
@@ -125,8 +125,6 @@ struct config_file_entry
 	const char *dpath;	/* DPATH if set from command line */
 	const char *configfile;
 
-	char *egdpool_path;
-
 	char *default_operstring;
 	char *default_adminstring;
 	char *kline_reason;
@@ -191,7 +189,6 @@ struct config_file_entry
 	int min_nonwildcard_simple;
 	int default_floodcount;
 	int client_flood;
-	int use_egd;
 	int ping_cookie;
 	int tkline_expire_notices;
 	int use_whois_actually;
diff --git a/src/ircd.c b/src/ircd.c
index 1d5b36b..c988128 100644
--- a/src/ircd.c
+++ b/src/ircd.c
@@ -653,12 +653,7 @@ ratbox_main(int argc, char *argv[])
 	else
 		ConfigServerHide.links_disabled = 1;
 
-	if(ConfigFileEntry.use_egd && (ConfigFileEntry.egdpool_path != NULL))
-	{
-		rb_init_prng(ConfigFileEntry.egdpool_path, RB_PRNG_EGD);
-	}
-	else
-		rb_init_prng(NULL, RB_PRNG_DEFAULT);
+        rb_init_prng(NULL, RB_PRNG_DEFAULT);
 	seed_random(NULL);
 
 	init_main_logfile(logFileName);
diff --git a/src/newconf.c b/src/newconf.c
index 682ffd9..94aa7eb 100644
--- a/src/newconf.c
+++ b/src/newconf.c
@@ -2342,7 +2342,6 @@ static struct conf_items conf_general_table[] =
 	{ "kline_delay", 	CF_TIME,   conf_set_general_kline_delay,	0, NULL },
 	{ "default_operstring",	CF_QSTRING, NULL, REALLEN,    &ConfigFileEntry.default_operstring },
 	{ "default_adminstring",CF_QSTRING, NULL, REALLEN,    &ConfigFileEntry.default_adminstring },
-	{ "egdpool_path",	CF_QSTRING, NULL, MAXPATHLEN, &ConfigFileEntry.egdpool_path },
 	{ "kline_reason",	CF_QSTRING, NULL, REALLEN, &ConfigFileEntry.kline_reason },
 
 	{ "anti_spam_exit_message_time", CF_TIME,  NULL, 0, &ConfigFileEntry.anti_spam_exit_message_time },
@@ -2398,7 +2397,6 @@ static struct conf_items conf_general_table[] =
 	{ "target_change",	CF_YESNO, NULL, 0, &ConfigFileEntry.target_change	},
 	{ "collision_fnc",	CF_YESNO, NULL, 0, &ConfigFileEntry.collision_fnc	},
 	{ "ts_max_delta",	CF_TIME,  NULL, 0, &ConfigFileEntry.ts_max_delta	},
-	{ "use_egd",		CF_YESNO, NULL, 0, &ConfigFileEntry.use_egd		},
 	{ "ts_warn_delta",	CF_TIME,  NULL, 0, &ConfigFileEntry.ts_warn_delta	},
 	{ "use_whois_actually", CF_YESNO, NULL, 0, &ConfigFileEntry.use_whois_actually	},
 	{ "warn_no_nline",	CF_YESNO, NULL, 0, &ConfigFileEntry.warn_no_nline	},
diff --git a/src/s_conf.c b/src/s_conf.c
index cdf325f..7dc5604 100644
--- a/src/s_conf.c
+++ b/src/s_conf.c
@@ -787,14 +787,12 @@ set_default_conf(void)
 	ConfigFileEntry.fname_operspylog = NULL;
 	ConfigFileEntry.fname_ioerrorlog = NULL;
 	ConfigFileEntry.glines = NO;
-	ConfigFileEntry.use_egd = NO;
 	ConfigFileEntry.gline_time = 12 * 3600;
 	ConfigFileEntry.gline_min_cidr = 16;
 	ConfigFileEntry.gline_min_cidr6 = 48;
 	ConfigFileEntry.hide_error_messages = 1;
 	ConfigFileEntry.dots_in_ident = 0;
 	ConfigFileEntry.max_targets = MAX_TARGETS_DEFAULT;
-	ConfigFileEntry.egdpool_path = NULL;
 	ConfigFileEntry.use_whois_actually = YES;
 	ConfigFileEntry.burst_away = NO;
 	ConfigFileEntry.hide_spoof_ips = YES;
diff --git a/src/sslproc.c b/src/sslproc.c
index 31ce3c6..edb0c29 100644
--- a/src/sslproc.c
+++ b/src/sslproc.c
@@ -327,10 +327,7 @@ start_ssldaemon(int count, const char *ssl_cert, const char *ssl_private_key,
 		ctl = allocate_ssl_daemon(F1, P2, pid);
 		if(ircd_ssl_ok)
 		{
-			if(ConfigFileEntry.use_egd && (ConfigFileEntry.egdpool_path != NULL))
-				send_init_prng(ctl, RB_PRNG_EGD, ConfigFileEntry.egdpool_path);
-			else
-				send_init_prng(ctl, RB_PRNG_DEFAULT, NULL);
+			send_init_prng(ctl, RB_PRNG_DEFAULT, NULL);
 		}
 		if(ircd_ssl_ok && ssl_cert != NULL && ssl_private_key != NULL)
 			send_new_ssl_certs_one(ctl, ssl_cert, ssl_private_key,
-- 
2.7.4

