From 1c219689a015642e122f8ce09c5c5b2245d94234 Mon Sep 17 00:00:00 2001
From: "Aaron Sethman (androsyn)" <androsyn@ratbox.org>
Date: Wed, 13 Jan 2016 18:01:32 +0000
Subject: [PATCH 74/89] log to stderr if -foreground is passed

git-svn-id: http://svn.ratbox.org/svnroot/ircd-ratbox/branches/RATBOX_3_0@29287 b93f080a-4cfa-0310-a19a-80a68f531ef9
---
 src/s_log.c | 14 +++++++++-----
 1 file changed, 9 insertions(+), 5 deletions(-)

diff --git a/src/s_log.c b/src/s_log.c
index 442a9bc..651523e 100644
--- a/src/s_log.c
+++ b/src/s_log.c
@@ -184,13 +184,17 @@ ilog(ilogfile dest, const char *format, ...)
 	va_end(args);
 
 	rb_snprintf(buf2, sizeof(buf2), "%s %s\n", smalldate(rb_current_time()), buf);
-#ifdef _WIN32
-	fputs(buf2, stderr);
-	fflush(stderr);
 
-	if(logfile == NULL)
-		return;
+#ifndef _WIN32
+        if(logfile == NULL || server_state_foreground)
+        {
 #endif
+                fputs(buf2, stderr);
+                fflush(stderr);
+#ifndef _WIN32
+        }
+#endif   
+
 	if(fputs(buf2, logfile) < 0)
 	{
 		sendto_realops_flags(UMODE_ALL, L_ALL, "Closing logfile: %s (%s)",
-- 
2.7.4

